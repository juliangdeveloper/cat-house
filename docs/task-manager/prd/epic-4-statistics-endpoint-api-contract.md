# Epic 4: Statistics Command Action & API Contract

**Goal:** Build the statistics command action following the Universal Command Pattern for Cat House integration, and provide comprehensive API documentation for all command actions.

## Story 4.1: Task Statistics Calculation Logic

As a **developer**,  
I want **business logic to calculate task statistics**,  
so that **I can expose meaningful metrics via the get-stats command action**.

**Acceptance Criteria:**
1. Create service/module that calculates total task count for a user
2. Calculate count of tasks by status (pending, in_progress, completed)
3. Calculate completion rate as percentage (completed / total)
4. Calculate overdue task count (due_date < current date and status != completed)
5. All calculations respect user isolation (only count user's tasks)
6. Logic is unit testable independent of HTTP layer

## Story 4.2: Statistics Command Action (get-stats)

As a **Cat House Platform**,  
I want **a standardized get-stats command action**,  
so that **I can retrieve task metrics to calculate Whiskers' personality and mood**.

**Acceptance Criteria:**
1. Implement `get_stats_handler(user_id: str, payload: dict, db)` in `app/commands/handlers/stats.py`
2. Handler accepts empty payload: `{}`
3. Handler uses user_id from command to calculate statistics
4. Response includes: `{ total_tasks, pending_tasks, in_progress_tasks, completed_tasks, completion_rate, overdue_tasks }`
5. Handler returns stats object even if user has zero tasks (all counts = 0, completion_rate = 0.0)
6. Response time under 200ms for users with up to 1000 tasks
7. Handler requires valid X-Service-Key authentication (enforced by router)
8. Stats calculated in real-time (not cached) for MVP
9. Handler registered in ACTION_HANDLERS dictionary: `"get-stats": get_stats_handler`
10. Handler returns dict compatible with CommandResponse model

## Story 4.3: API Documentation with OpenAPI/Swagger

As a **API consumer**,  
I want **comprehensive API documentation**,  
so that **I can understand and test all available command actions**.

**Acceptance Criteria:**
1. OpenAPI 3.0 specification automatically generated by FastAPI for all endpoints
2. Documentation includes: endpoint paths, HTTP methods, request/response schemas (Pydantic models), status codes, error formats
3. Swagger UI is accessible at /docs endpoint (FastAPI default)
4. Documentation includes example requests and responses for each command action (create-task, list-tasks, get-task, update-task, delete-task, get-stats)
5. Authentication requirements are clearly documented (apiKey security scheme for X-Service-Key header)
6. Command action patterns and payload structures are explicitly documented for Cat House integration
7. CommandRequest and CommandResponse models are documented with all available actions
8. Error response formats are documented (validation errors, authentication errors, unknown action errors)

---
